#!/usr/bin/env M2 --script

load (getenv("ADAM_ROOT")|"superADAM/share/ADAM.m2")
needsPackage "PolynomialDynamicalSystems"
needs "gfan.m2"

helpString = ///usage: gfan <json-timeseries-data >json-rev-eng-output-model
///

if #scriptCommandLine != 1 then (
    stderr << helpString;
    exit(1);
    )

--------------------------------
TS = readTSDataFromJSON get stdio
PDS = gfanRevEng TS
outputJSON = prettyPrintJSON createRevEngJSONOutputModel PDS
print outputJSON

end

restart
-- example:
./gfan <../test/Gepasi-input.json
./gfan <../test/test1-input.json >foo-1
./gfan help

restart
-- run this in basicRevEng/src dir
load (getenv("ADAM_ROOT")|"superADAM/share/ADAM.m2")
needsPackage "PolynomialDynamicalSystems"
needs "gfan.m2"
TS = readTSDataFromJSON get "../test/test1-input.json"
PDS = gfanRevEng TS
createRevEngJSONOutputModel PDS;
outputJSON = prettyPrintJSON oo

restart
-- run this in basicRevEng/src dir
load (getenv("ADAM_ROOT")|"superADAM/share/ADAM.m2")
needsPackage "PolynomialDynamicalSystems"
needs "gfan.m2"
TS = readTSDataFromJSON get "../test/test2-input.json"
PDS = gfanRevEng TS
createRevEngJSONOutputModel PDS
outputJSON = prettyPrintJSON oo
"sample-output-2.json" << outputJSON  << endl << close;
-- run this in gfan/src dir
restart
load (getenv("ADAM_ROOT")|"superADAM/share/ADAM.m2")
needsPackage "PolynomialDynamicalSystems"
needs "gfan.m2"
TS = readTSDataFromJSON get "../test/test2-input.json"
PDS = gfanRevEng TS
outputJSON = prettyPrintJSON createRevEngJSONOutputModel PDS
print outputJSON

